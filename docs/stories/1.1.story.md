# Story 1.1: Project Initialisation & Core Dependencies

## Status
Approved

## Story
**As a** Developer,
**I want** to establish the foundational Next.js monorepo project structure with all core dependencies and configurations,
**so that** I have a solid technical foundation to build the AI Food Photo Enhancer MVP features upon.

## Acceptance Criteria
1. **AC1**: Complete Next.js 15.4 application setup with TypeScript 5.8.3 in a monorepo structure using pnpm workspaces and Turborepo
2. **AC2**: Core dependencies installed and configured according to tech stack specifications (HeroUI 2.8.2, Tailwind CSS 4.1.2, Motion.dev 12.23.11)
3. **AC3**: Supabase 2.53.0 integration configured with database connection, authentication, and storage setup
4. **AC4**: Development environment configured with ESLint, testing framework (Vitest 3.2.4), and build pipeline
5. **AC5**: Basic project structure established following the unified project structure guidelines
6. **AC6**: Environment variables and configuration management set up for development/production environments
7. **AC7**: Initial deployment pipeline configured for Vercel platform

## Tasks / Subtasks
- [ ] **Task 1**: Initialize monorepo structure (AC: 1)
  - [ ] Create root package.json with pnpm workspaces configuration → `/package.json`
  - [ ] Set up Turborepo configuration for build optimization → `/turbo.json`
  - [ ] Create apps/web directory for main Next.js application → `/apps/web/`
  - [ ] Create packages/ directory for shared components and configurations → `/packages/`
  - [ ] Initialize packages/ui, packages/eslint-config, packages/tsconfig → `/packages/ui/package.json`, `/packages/eslint-config/package.json`, `/packages/tsconfig/package.json`

- [ ] **Task 2**: Configure Next.js application with core dependencies (AC: 1, 2)
  - [ ] Initialize Next.js 15.4 app with TypeScript 5.8.3 in apps/web
  - [ ] Configure App Router structure
  - [ ] Install and configure HeroUI 2.8.2 component library
  - [ ] Set up Tailwind CSS 4.1.2 with glassmorphic design tokens
  - [ ] Configure Motion.dev 12.23.11 for animations
  - [ ] Set up Sharp.js 0.34.3 for image processing

- [ ] **Task 3**: Establish Supabase integration (AC: 3)
  - [ ] Install Supabase client library 2.53.0
  - [ ] Configure Supabase connection and environment variables
  - [ ] Set up authentication configuration
  - [ ] Configure file storage settings
  - [ ] Create initial database connection test → `/apps/web/lib/__tests__/supabase.test.ts`
  - [ ] **VALIDATION**: Verify connection with test query → `SELECT 1`
  - [ ] **VALIDATION**: Test authentication flow with test user
  - [ ] **VALIDATION**: Verify file upload to storage bucket
  - [ ] **VALIDATION**: Confirm environment variables load correctly

- [ ] **Task 4**: Configure development tooling (AC: 4)
  - [ ] Set up ESLint configuration in packages/eslint-config → `/packages/eslint-config/index.js`
  - [ ] Configure Vitest 3.2.4 testing framework → `/apps/web/vitest.config.ts`
  - [ ] Set up TypeScript configuration in packages/tsconfig → `/packages/tsconfig/base.json`, `/packages/tsconfig/nextjs.json`
  - [ ] Configure build pipeline with Turborepo → `/turbo.json` pipeline definitions
  - [ ] Set up development scripts and tooling → `/apps/web/package.json` scripts section

- [ ] **Task 5**: Implement unified project structure (AC: 5)
  - [ ] Create apps/web/app directory structure (App Router)
  - [ ] Set up apps/web/components directory for UI components
  - [ ] Create apps/web/lib directory for helper functions and clients
  - [ ] Establish proper file organization patterns
  - [ ] Create placeholder files to demonstrate structure

- [ ] **Task 6**: Environment and configuration management (AC: 6)
  - [ ] Set up environment variable management → `/apps/web/.env.local`, `/apps/web/.env.example`
  - [ ] Configure development/production environment separation → `/apps/web/lib/env.ts`
  - [ ] Set up Zod 4.0.14 for environment validation → `/apps/web/lib/env.ts` validation schema
  - [ ] Create configuration files for different environments → `/apps/web/next.config.js`
  - [ ] Document environment setup in README → `/README.md` Environment Setup section

- [ ] **Task 7**: Deploy and verify foundation (AC: 7)
  - [ ] Configure Vercel deployment settings
  - [ ] Set up continuous deployment pipeline
  - [ ] Deploy initial foundation to verify setup
  - [ ] Configure domain and basic routing
  - [ ] Verify all integrations work in production environment

- [ ] **Task 8**: Integration Validation & Health Checks (AC: ALL)
  - [ ] Create integration health check endpoint → `/apps/web/app/api/health/route.ts`
  - [ ] Implement Supabase connectivity test → Database ping, Auth service check, Storage access
  - [ ] Verify all environment variables are accessible → Zod validation pass
  - [ ] Test build pipeline end-to-end → Full build, type check, test run
  - [ ] Validate deployment readiness → Vercel build check, environment sync
  - [ ] Document troubleshooting steps → `/apps/web/TROUBLESHOOTING.md`

## Dev Notes

### Tech Stack Configuration
**Source: [architecture.md#tech-stack]**

**Core Framework & Runtime:**
- Next.js 15.4 with React 19 compatibility, Turbopack, App Router stable
- TypeScript 5.8.3 with ES module improvements, new type checks
- Node.js 22.17.1 LTS with V8 12.4, built-in WebSocket, improved watch mode

**Frontend & UI:**
- HeroUI 2.8.2: 200+ components, React 19 typings, Tailwind v4 integration
- Tailwind CSS 4.1.2: Native CSS nesting, logical props, improved JIT caching
- Motion.dev 12.23.11: React 19 animations, async variants, reduced bundle size

**Backend & Services:**
- Supabase 2.53.0: Branching 2.0, Storage 10× uploads, Node 20+ target
- Sharp.js 0.34.3: Animated GIF→WebP fix, PDF background support
- Zod 4.0.14: v3/v4 permalinks, faster parsing, optional chaining fix

**Development Tools:**
- pnpm 10.13.1: Corepack-aware, new lockfile, faster hoisting
- Vitest 3.2.4: Snapshots v2, performance improvements, UI 2.2, Node 18+ default
- Sentry 9.43.0: OTEL 1.34, Vercel AI tracing, SpotLight suppression

### Repository Structure
**Source: [architecture.md#unified-project-structure]**

```plaintext
/
├── apps/
│   └── web/                # The main Next.js application
│       ├── app/            # App Router directories
│       ├── components/     # UI components (HeroUI based)
│       ├── lib/            # Helper functions, Stripe/Supabase clients
│       └── ...
├── packages/
│   ├── ui/                 # Shared, unstyled UI components
│   ├── eslint-config/      # Shared ESLint configuration
│   └── tsconfig/           # Shared TypeScript configuration
└── package.json            # Root package configuration
```

### Deployment Architecture
**Source: [architecture.md#deployment-architecture]**

- **Vercel Platform**: Next.js application deployment with Git integration, serverless functions for API, global edge network
- **Environment Management**: Isolated environments with encrypted environment variables
- **Continuous Deployment**: Git-based deployment pipeline with automatic builds

### Security Configuration
**Source: [architecture.md#security]**

- **Environment Variables**: All secrets and API keys managed as encrypted environment variables
- **Data Protection**: All data encrypted at rest and in transit
- **Infrastructure**: Environment isolation with secure server-side clients for admin operations

### Performance Benchmarks & Targets

**Initial Build Performance Targets:**
- Cold build time: < 30 seconds
- Hot reload time: < 2 seconds  
- Bundle size (initial): < 250KB gzipped
- First Contentful Paint: < 1.5s
- Largest Contentful Paint: < 2.5s
- Cumulative Layout Shift: < 0.1

**Development Experience Targets:**
- pnpm install time: < 60 seconds
- Test suite execution: < 10 seconds
- TypeScript compilation: < 5 seconds
- Turborepo cache hit ratio: > 80%

**Integration Performance Baselines:**
- Supabase connection establishment: < 500ms
- Environment validation (Zod): < 100ms
- Image processing (Sharp.js) baseline: < 2s for 1MB image

### Previous Story Insights
This is the first story, so no previous insights available.

## Testing

### Testing Standards
**Source: [architecture.md#tech-stack]**

- **Framework**: Vitest 3.2.4 with Snapshots v2, performance improvements
- **Test Location**: Tests should be co-located with components in `__tests__` directories or `.test.ts` files
- **Coverage**: Unit tests for utility functions, integration tests for API endpoints
- **Standards**: Follow testing pyramid approach with unit, integration, and end-to-end tests
- **Configuration**: Use shared test configuration from packages/tsconfig

### Testing Requirements for This Story
- Unit tests for environment configuration validation
- Integration tests for Supabase connection
- Build pipeline verification tests
- Deployment smoke tests

## Rollback Procedures

### Development Rollback Steps
**If issues occur during development:**

1. **Dependency Issues:**
   - Rollback to previous package.json states: `git checkout HEAD~1 package.json apps/web/package.json`
   - Clear node_modules and reinstall: `rm -rf node_modules && pnpm install`
   - Reset lockfile if corrupted: `rm pnpm-lock.yaml && pnpm install`

2. **Configuration Issues:**
   - Restore working configurations: `git checkout HEAD~1 -- turbo.json next.config.js`
   - Reset environment variables to defaults: Copy from `.env.example`
   - Revert TypeScript configs: `git checkout HEAD~1 -- packages/tsconfig/`

3. **Build Pipeline Issues:**
   - Rollback Turborepo config: `git checkout HEAD~1 -- turbo.json`
   - Reset to basic Next.js build: Remove custom webpack config from `next.config.js`
   - Disable problematic optimizations: Comment out Turbopack usage

4. **Integration Rollback:**
   - Disconnect Supabase: Remove client initialization, comment out usage
   - Revert to mock implementations: Replace real clients with test doubles
   - Disable external services: Add feature flags to environment config

### Emergency Deployment Rollback
**If production deployment fails:**

1. **Vercel Platform Rollback:**
   - Use Vercel dashboard to rollback to previous deployment
   - Alternative: `vercel --prod --rollback`

2. **Git-based Rollback:**
   - Create rollback branch: `git checkout -b rollback-foundation`
   - Reset to working commit: `git reset --hard <last-working-commit>`
   - Force deploy: `git push origin rollback-foundation --force`

3. **Environment Recovery:**
   - Verify environment variables in Vercel dashboard
   - Test database connectivity from Vercel functions
   - Confirm all external service configurations

### Rollback Success Criteria
- Application builds without errors
- All tests pass
- Development server starts successfully  
- Production deployment completes
- Health checks return 200 status

## Change Log

| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 30-Jul-2025 | 1.0 | Initial story creation | Bob (Scrum Master) |
| 30-Jul-2025 | 1.1 | Quality improvements: Added specific file paths, performance benchmarks, validation steps, and rollback procedures | Bob (Scrum Master) |

## Dev Agent Record

*This section will be populated by the development agent during implementation*

### Agent Model Used
*To be filled by dev agent*

### Debug Log References
*To be filled by dev agent*

### Completion Notes List
*To be filled by dev agent*

### File List
*To be filled by dev agent*

## QA Results

*Results from QA Agent review will be populated here after implementation*